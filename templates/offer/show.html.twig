{% extends 'base.html.twig' %}

{% block title %}{{ offer.title }}{% endblock %}

{% block body %}
    <h1>{{ offer.title }}</h1>

    <p><strong>Entreprise :</strong> {{ offer.company.name }}</p>
    <p><strong>Auteur :</strong> {{ offer.author.email }}</p>
    <p><strong>Statut :</strong> {{ offer.status }}</p>

    <p>{{ offer.description }}</p>

    <p><strong>Catégories d’impact :</strong>
        {% if offer.impactCategories is not empty %}
            {{ offer.impactCategories|join(', ') }}
        {% else %}
            <em>Aucune</em>
        {% endif %}
    </p>

    <p>
        <a href="{{ path('offer_edit', {id: offer.id}) }}">Modifier</a>
        |
        <a href="{{ path('offer_index') }}">Retour à la liste</a>
    </p>

    {% if offer.status == constant('App\\\\Entity\\\\Offer::STATUS_DRAFT') %}
        <section>
            <h2>Soumettre à la modération</h2>
            <form method="post" action="{{ path('offer_submit', {id: offer.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('submit_offer_' ~ offer.id) }}">
                <label for="actor_id">Auteur</label>
                <select id="actor_id" name="actor_id" required>
                    <option value="">Sélectionner un auteur</option>
                    {% for user in offer.author ? [offer.author] : [] %}
                        <option value="{{ user.id }}">{{ user.email }}</option>
                    {% endfor %}
                </select>
                <button class="btn" type="submit">Soumettre</button>
            </form>
        </section>
    {% endif %}

    {% if offer.status == constant('App\\\\Entity\\\\Offer::STATUS_SUBMITTED') %}
        <section>
            <h2>Modération</h2>
            <a class="btn" href="{{ path('offer_moderate', {id: offer.id}) }}">Prendre une décision</a>
        </section>
    {% endif %}
{% endblock %}
