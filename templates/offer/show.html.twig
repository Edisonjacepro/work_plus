{% extends 'base.html.twig' %}

{% block title %}{{ offer.title }}{% endblock %}

{% block body %}
    <h1>{{ offer.title }}</h1>

    <p><strong>Entreprise :</strong> {{ offer.company.name }}</p>
    <p>
        <strong>Date de publication :</strong>
        {{ offer.publishedAt ? offer.publishedAt|date('d/m/Y H:i') : 'Non publiee' }}
    </p>
    {% if app.user and offer.author and app.user.id == offer.author.id %}
        <p><strong>Statut :</strong> {{ offer.status }}</p>
    {% endif %}

    <p>{{ offer.description }}</p>

    <p><strong>Categories d'impact :</strong>
        {% if offer.impactCategories is not empty %}
            {{ offer.impactCategories|join(', ') }}
        {% else %}
            <em>Aucune</em>
        {% endif %}
    </p>

    <p>
        {% if is_granted('EDIT', offer) %}
            <a href="{{ path('offer_edit', {id: offer.id}) }}">Modifier</a>
            |
        {% endif %}
        <a href="{{ path('offer_index') }}">Retour a la liste</a>
    </p>

    {% if is_granted('ROLE_ADMIN') %}
        <section>
            <h2>Visibilite</h2>
            <form method="post" action="{{ path('offer_toggle_visibility', {id: offer.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('toggle_visibility_' ~ offer.id) }}">
                <button class="btn" type="submit">
                    {{ offer.isVisible ? 'Masquer' : 'Rendre visible' }}
                </button>
            </form>
        </section>
    {% endif %}

    {% if offer.status == 'DRAFT' and is_granted('PUBLISH', offer) %}
        <section>
            <h2>Publier l'offre</h2>
            <form method="post" action="{{ path('offer_publish', {id: offer.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('publish_offer_' ~ offer.id) }}">
                <button class="btn" type="submit">Publier</button>
            </form>
        </section>
    {% endif %}

    {% if offer.status == 'PUBLISHED' and is_granted('UNPUBLISH', offer) %}
        <section>
            <h2>Repasser en brouillon</h2>
            <form method="post" action="{{ path('offer_unpublish', {id: offer.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('unpublish_offer_' ~ offer.id) }}">
                <button class="btn" type="submit">Mettre en brouillon</button>
            </form>
        </section>
    {% endif %}

    {% if canApply and applicationForm %}
        <section>
            <h2>Postuler a cette offre</h2>
            {{ form_start(applicationForm) }}
                {{ form_row(applicationForm.email) }}
                {{ form_row(applicationForm.firstName) }}
                {{ form_row(applicationForm.lastName) }}
                {{ form_row(applicationForm.message) }}
                {{ form_row(applicationForm.cvFile) }}
                <button class="btn" type="submit">Envoyer ma candidature</button>
            {{ form_end(applicationForm) }}
        </section>
    {% endif %}
{% endblock %}
